<div mat-dialog-title class="dialog-title">
  <h2>{{ titulo }}</h2>
  <button mat-icon-button (click)="onClose()" title="Fechar">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content>
  @if (pedidos$ | async; as pedidos) {
    @if (pedidos.length > 0) {
      <mat-accordion multi> 
        @for (pedido of pedidos; track pedido.id) {
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>shopping_cart</mat-icon> 
                <span class="pedido-title">{{ pedido.titulo }}</span>
              </mat-panel-title>
              <mat-panel-description>
                <span class="pedido-meta">
                  {{ pedido.participacoes?.length || 0 }} Participação(ões)
                  <mat-icon class="small-icon">comment</mat-icon> {{ pedido.totalComentarios || 0 }}
                </span>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <mat-list>
              @if (pedido.participacoes && pedido.participacoes.length > 0) {
                @for (participacao of pedido.participacoes; track participacao.id) {
                  
                    <mat-list-item>
                      <img matListItemAvatar [src]="'https://i.pravatar.cc/300?img=' + participacao.id % 20" alt="Avatar">
                      <div matListItemTitle>{{ participacao.usuarioNome }}</div>
                      <div matListItemLine>Ofereceu ajuda {{ participacao.dataParticipacao | date:'shortTime' }}</div>
                      <button mat-flat-button color="primary" (click)="aceitarParticipacao(participacao.id)">ACEITAR</button>
                    </mat-list-item>
                    <mat-divider></mat-divider>
                  
                } @empty {
                   <p class="empty-state-small">Nenhuma participação pendente para este pedido.</p>
                }
              } @else {
                <p class="empty-state-small">Nenhuma participação oferecida para este pedido ainda.</p>
              }
            </mat-list>
          </mat-expansion-panel>
          <mat-divider></mat-divider>
        }
      </mat-accordion>
    } @else {
      <p class="empty-state">Você não possui pedidos aguardando aprovação.</p>
    }
  } @else {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onClose()">Cancelar</button>
</mat-dialog-actions>